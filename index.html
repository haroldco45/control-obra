<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Inventario Pro - Vibras Positivas</title>
    <style>
        :root { --negro: #1a1a1a; --oro: #f1c40f; --fondo: #f8f9fa; --borde: #d1d1d1; --exito: #27ae60; --error: #e74c3c; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--fondo); margin: 0; color: var(--negro); }
        
        header { background: var(--negro); color: var(--oro); padding: 25px 15px; text-align: center; border-bottom: 6px solid var(--oro); }
        .container { padding: 15px; max-width: 650px; margin: auto; }
        
        .card { background: #ffffff; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-top: 4px solid var(--oro); }
        h3 { margin-top: 0; font-size: 14px; letter-spacing: 1px; color: #555; text-transform: uppercase; display: flex; align-items: center; gap: 8px; }

        input, select { width: 100%; padding: 14px; margin: 10px 0; border-radius: 8px; border: 1px solid var(--borde); font-size: 15px; background: #fff; }
        
        /* Sistema de Categor√≠as de Movimiento */
        .grid-categorias { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0; }
        .cat-btn { padding: 10px; border: 1px solid var(--borde); border-radius: 8px; font-size: 12px; text-align: center; cursor: pointer; transition: 0.2s; background: #fff; }
        .cat-btn.active { background: var(--oro); border-color: var(--oro); font-weight: bold; }

        /* Filas de Inventario */
        .item-row { display: grid; grid-template-columns: 2fr 1fr; gap: 10px; padding: 12px 0; border-bottom: 1px solid #eee; }
        .item-row:last-child { border: none; }
        
        .btn-main { background: var(--negro); color: var(--oro); border: none; padding: 18px; border-radius: 12px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .btn-sec { background: #eee; color: #444; border: none; padding: 10px; border-radius: 8px; width: 100%; font-size: 12px; cursor: pointer; }

        #signature-pad { border: 2px dashed #bbb; background: #fff; border-radius: 10px; width: 100%; height: 120px; touch-action: none; }
        footer { text-align: center; padding: 30px; font-size: 11px; line-height: 1.6; color: #888; }
    </style>
</head>
<body onload="setupApp()">

<header>
    <div style="font-weight: 300; font-size: 12px; letter-spacing: 4px; margin-bottom: 5px;">SISTEMA DE GESTI√ìN</div>
    <strong>VIBRAS POSITIVAS</strong>
    <div id="ticket-id" style="font-size: 11px; margin-top: 8px; opacity: 0.8;">ID: --</div>
</header>

<div class="container">
    
    <div class="card">
        <h3>üë∑ Responsable y Ubicaci√≥n</h3>
        <input type="text" id="operario" placeholder="Nombre del responsable">
        <input type="text" id="frente" placeholder="Frente de Obra / Destino">
    </div>

    <div class="card">
        <h3>üîÑ Tipo de Movimiento</h3>
        <div class="grid-categorias">
            <div class="cat-btn" onclick="setTipo(this, 'üì¶ INVENTARIO (Entrada)')">ENTRADA STOCK</div>
            <div class="cat-btn" onclick="setTipo(this, 'üõ†Ô∏è PR√âSTAMO (Herramienta)')">PR√âSTAMO</div>
            <div class="cat-btn" onclick="setTipo(this, 'üîÑ DEVOLUCI√ìN')">DEVOLUCI√ìN</div>
            <div class="cat-btn active" onclick="setTipo(this, 'üì§ CONSUMO (Salida)')">CONSUMO/SALIDA</div>
            <div class="cat-btn" onclick="setTipo(this, '‚ö†Ô∏è AVER√çA / DA√ëO')">AVER√çA / DA√ëO</div>
            <div class="cat-btn" onclick="setTipo(this, 'üóëÔ∏è BAJA / P√âRDIDA')">BAJA / P√âRDIDA</div>
        </div>
        <input type="hidden" id="tipo_mov" value="üì§ CONSUMO (Salida)">
    </div>

    <div class="card">
        <h3>üìã Detalle de Art√≠culos</h3>
        <div id="items-container">
            <div class="item-row">
                <input type="text" placeholder="Art√≠culo (Ej: Cemento, Taladro...)" class="input-art">
                <input type="number" placeholder="Cant." class="input-cant">
            </div>
        </div>
        <button class="btn-sec" onclick="addItem()">+ AGREGAR OTRO ART√çCULO</button>
    </div>

    <div class="card">
        <h3>‚úçÔ∏è Firma de Auditor√≠a</h3>
        <canvas id="signature-pad"></canvas>
        <button class="btn-sec" onclick="clearPad()" style="margin-top:5px; padding: 5px;">Limpiar Firma</button>
    </div>

    <button class="btn-main" onclick="generarReporte()">üíæ REGISTRAR EN ALMAC√âN</button>

</div>

<footer>
    ESTA OPERACI√ìN ES VERIFICABLE Y AUDITABLE <br>
    <strong>LOG√çSTICA DE OBRA CIVIL - VIBRAS POSITIVAS</strong> <br>
    ¬© 2026 Innovaci√≥n y Control
</footer>

<script>
    let canvas, ctx, drawing = false;
    let currentID = "";

    function setupApp() {
        currentID = "ALM-" + Math.floor(Math.random() * 900000 + 100000);
        document.getElementById('ticket-id').innerText = "TRACKING ID: #" + currentID;
        
        // Recordar operario
        if(localStorage.getItem('last_op')) document.getElementById('operario').value = localStorage.getItem('last_op');

        canvas = document.getElementById('signature-pad');
        ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth;
        setupCanvas();
    }

    function setTipo(elem, valor) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        elem.classList.add('active');
        document.getElementById('tipo_mov').value = valor;
    }

    function addItem() {
        const div = document.createElement('div');
        div.className = 'item-row';
        div.innerHTML = `<input type="text" placeholder="Art√≠culo" class="input-art"><input type="number" placeholder="Cant." class="input-cant">`;
        document.getElementById('items-container').appendChild(div);
    }

    function setupCanvas() {
        const getPos = (e) => {
            const rect = canvas.getBoundingClientRect();
            return { x: (e.clientX || e.touches[0].clientX) - rect.left, y: (e.clientY || e.touches[0].clientY) - rect.top };
        };
        const start = (e) => { drawing = true; ctx.beginPath(); const p = getPos(e); ctx.moveTo(p.x, p.y); };
        const move = (e) => { if(!drawing) return; const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); e.preventDefault(); };
        const stop = () => { drawing = false; };

        canvas.addEventListener('mousedown', start);
        canvas.addEventListener('mousemove', move);
        window.addEventListener('mouseup', stop);
        canvas.addEventListener('touchstart', start);
        canvas.addEventListener('touchmove', move);
        canvas.addEventListener('touchend', stop);
    }

    function clearPad() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

    function generarReporte() {
        const op = document.getElementById('operario').value;
        const fr = document.getElementById('frente').value;
        const tp = document.getElementById('tipo_mov').value;
        
        if(!op || !fr) return alert("Por favor complete Responsable y Frente.");

        localStorage.setItem('last_op', op);

        let listado = "";
        document.querySelectorAll('.item-row').forEach(row => {
            const art = row.querySelector('.input-art').value;
            const cant = row.querySelector('.input-cant').value;
            if(art) listado += `‚ñ´Ô∏è ${art}: *${cant}*\n`;
        });

        const fecha = new Date().toLocaleString();

        let mensaje = `*üõ°Ô∏è AUDITOR√çA DE ALMAC√âN - VIBRAS POSITIVAS*\n`;
        mensaje += `-------------------------------------------\n`;
        mensaje += `üÜî *ID SEGUIMIENTO:* ${currentID}\n`;
        mensaje += `üìÖ *FECHA:* ${fecha}\n`;
        mensaje += `üë∑ *RESPONSABLE:* ${op}\n`;
        mensaje += `üìç *FRENTE/DESTINO:* ${fr}\n`;
        mensaje += `üìë *OPERACI√ìN:* ${tp}\n`;
        mensaje += `-------------------------------------------\n`;
        mensaje += `*DETALLE DE MOVIMIENTOS:*\n${listado}`;
        mensaje += `-------------------------------------------\n`;
        mensaje += `_Registro digital procesado para control de activos._`;

        const phone = "3117700431"; 
        window.location.href = `https://wa.me/57${phone}?text=${encodeURIComponent(mensaje)}`;
    }
</script>
</body>
</html>
